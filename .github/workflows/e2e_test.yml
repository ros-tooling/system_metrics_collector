name: End-to-end Testing (Nightly)
on:
  pull_request:
  # Running on pull requests to catch breaking changes as early as possible.
  # Waiting for this test to pass is recommended, but contributors can use their discretion whether they want to or not.
  schedule:
    # Run every morning Pacific Time. Random hour and minute to avoid creating excess traffic during popular times.
    - cron:  '17 17 * * *'

jobs:
  build_and_test:
    runs-on: ubuntu-latest
    container:
      image: rostooling/setup-ros-docker:ubuntu-focal-latest
    steps:
      # TODO(setup-ros-docker#7): calling chown is necessary for now
      - run: sudo chown -R rosbuild:rosbuild "$HOME" .
      - uses: ros-tooling/action-ros-ci@0.0.16
        with:
          package-name: system_metrics_collector
      - name: Run end-to-end test
        run:  ros_ws/src/system_metrics_collector/test/run_e2e_test.sh
